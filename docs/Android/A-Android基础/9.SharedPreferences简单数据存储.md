# ğŸ€ã€Androidã€‘6.0SharedPreferencesç®€å•æ•°æ®å­˜å‚¨

æ³¨æ„ï¼šä¸æ˜¯æ•™ç¨‹åªæ˜¯ç¬”è®°ï¼Œå¦‚æœ‰é”™è¯¯æ¬¢è¿æ‰¹è¯„æŒ‡æ­£

# å®˜ç½‘ç®€ä»‹

[ä¿å­˜é”®å€¼å¯¹æ•°æ® Â | Android å¼€å‘è€… Â | Android Developers (google.cn)](https://developer.android.google.cn/training/data-storage/shared-preferences?hl=zh-cn)
`**_SharedPreferences_**`æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®å­˜å‚¨æ–¹å¼

å¦‚æœæ‚¨æœ‰æƒ³è¦ä¿å­˜çš„ç›¸å¯¹è¾ƒå°é”®å€¼å¯¹é›†åˆï¼Œåˆ™åº”ä½¿ç”¨ `SharedPreferences` APIã€‚`SharedPreferences` å¯¹è±¡æŒ‡å‘åŒ…å«é”®å€¼å¯¹çš„æ–‡ä»¶ï¼Œå¹¶æä¾›è¯»å†™è¿™äº›é”®å€¼å¯¹çš„ç®€å•æ–¹æ³•ã€‚æ¯ä¸ª `SharedPreferences` æ–‡ä»¶å‡ç”±æ¡†æ¶è¿›è¡Œç®¡ç†ï¼Œå¯ä»¥æ˜¯ç§æœ‰æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯å…±äº«æ–‡ä»¶ã€‚
getPreferencesï¼ˆï¼‰ä¿å­˜ç§æœ‰æ–‡ä»¶

ä¾‹å¦‚ï¼šæˆ‘ä»¬ç™»å½•qqå¹¶ä¸æ˜¯æ¯æ¬¡éƒ½ä¼šè¦è¾“å…¥è´¦å·å¯†ç ï¼Œè€Œæ˜¯ä¼šè®°ä½å¯†ç å’Œç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œè¿™äº›è½»é‡çš„æ•°æ®å¯ä»¥é€šè¿‡`SharedPreferences`ä»¥é”®å€¼å¯¹çš„æ–¹å¼å­˜å‚¨åœ¨æœ¬åœ°

# ğŸŒ¾SharedPreferencesçš„ä½¿ç”¨ï¼ˆæ¨¡æ‹ŸQQç™»å½•ï¼‰

è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªActivityï¼Œåˆ†åˆ«ä»£è¡¨QQæ¬¢è¿ç•Œé¢ï¼Œç”¨æˆ·ç™»å½•ç•Œé¢å’Œç”¨æˆ·é¦–é¡µç•Œé¢

![](/images/2837b71959af3359d0c415013bf2989f.png)

### ğŸ˜ç®€å•çš„ä¸ºç™»å½•ç•Œé¢åŠ ä¸€äº›ç»„ä»¶

![](/images/ad335d6b3ed6a10472411890c5319dc8.png)

**activtiy_login.xmlå…³é”®ä»£ç **

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".LoginActivity">

    <TextView
        android:id="@+id/textView"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginStart="52dp"
        android:layout_marginTop="160dp"
        android:text="è´¦å·ï¼š"
        android:textSize="20sp"
        android:textColor="@color/black"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

    <TextView
        android:id="@+id/textView2"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="48dp"
        android:text="å¯†ç ï¼š"
        android:textSize="20sp"
        android:textColor="@color/black"
        app:layout_constraintStart_toStartOf="@+id/textView"
        app:layout_constraintTop_toBottomOf="@+id/textView" />

    <EditText
        android:id="@+id/editTextTextPersonName"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginStart="32dp"
        android:ems="10"
        android:inputType="textPersonName"
        android:text="Name"
        app:layout_constraintBottom_toBottomOf="@+id/textView"
        app:layout_constraintStart_toEndOf="@+id/textView"
        app:layout_constraintTop_toTopOf="@+id/textView" />

    <EditText
        android:id="@+id/editTextTextPassword"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:ems="10"
        android:inputType="textPassword"
        app:layout_constraintBottom_toBottomOf="@+id/textView2"
        app:layout_constraintStart_toStartOf="@+id/editTextTextPersonName"
        app:layout_constraintTop_toTopOf="@+id/textView2" />

    <Button
        android:id="@+id/button"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="92dp"
        android:text="ç™»å½•"
        android:textSize="20sp"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintHorizontal_bias="0.498"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/editTextTextPassword" />
</androidx.constraintlayout.widget.ConstraintLayout>
```

### ğŸ˜†åœ¨LoginActivityä¸­å†™éªŒè¯ç™»å½•çš„é€»è¾‘ä»£ç 

ç”¨æˆ·å¦‚æœéªŒè¯ç™»å½•æˆåŠŸï¼Œæˆ‘ä»¬è¦å°†ç”¨æˆ·çš„ç”¨æˆ·åä»¥åŠç™»å½•çŠ¶æ€é€šè¿‡`SharedPreferences`ä»¥é”®å€¼å¯¹çš„å½¢å¼ä¿å­˜åœ¨æœ¬åœ°ç£ç›˜ä¸­ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š

```java
//SharedPreferencesæ˜¯æ¥å£ï¼Œå¹¶ä¸æ˜¯ç±»
/*getSharedPreferences(å‚æ•°ä¸€,å‚æ•°äºŒ)
å‚æ•°ä¸€: å­˜å‚¨æ•°æ®çš„æ–‡ä»¶å
å‚æ•°äºŒ: æ•°æ®å­˜å‚¨æ–¹å¼
 */
//è·å–SharedPreferenceså¯¹è±¡
SharedPreferences sp=getSharedPreferences("user",MODE_PRIVATE);
//è·å–Editorå¯¹è±¡çš„å¼•ç”¨
SharedPreferences.Editor editor=sp.edit();
//å°†è·å–è¿‡æ¥çš„å€¼æ”¾å…¥æ–‡ä»¶
editor.putString("username","Starryé™†ç¦»");
editor.putBoolean("isLogin",true);
//æœ€åè¦æäº¤æ•°æ®åˆ°æœ¬åœ°
editor.commit();
```

å¯ä»¥çœ‹åˆ°`getSharedPreferences();`æ–¹æ³•å­˜å‚¨æ•°æ®çš„æ–¹å¼æœ‰å¤šç§ï¼Œå…¶ä¸­3ç§å·²ç»åœ¨Android7.0ä¸­å¼ƒç”¨

| MODE_PRIVATE | æŒ‡å®šè¯¥SharedPreferencesæ•°æ®åªèƒ½è¢«æœ¬åº”ç”¨ç¨‹åº |
| --- | --- |
| MODE_APPEND | è¯¥æ¨¡å¼ä¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨å°±å¾€æ–‡ä»¶è¿½åŠ å†…å®¹ï¼Œå¦åˆ™å°±åˆ›å»ºæ–°æ–‡ä»¶ï¼› |
| MODE_WORLD_READABLE | æŒ‡å®šè¯¥SharedPreferencesæ•°æ®èƒ½è¢«å…¶ä»–åº”ç”¨ç¨‹åºè¯»ï¼Œä½†ä¸èƒ½å†™(ä¸å®‰å…¨ï¼Œå·²å¼ƒç”¨) |
| MODE_WORLD_WRITEABLE | æŒ‡å®šè¯¥SharedPreferencesæ•°æ®èƒ½è¢«å…¶ä»–åº”ç”¨ç¨‹åºè¯»å–å’Œå†™å…¥(ä¸å®‰å…¨ï¼Œå·²å¼ƒç”¨) |


![](/images/664658a7d3171848c2caa97061b3514a.png)

**æ³¨æ„**ï¼šè‡ª API çº§åˆ« 17 èµ·ï¼Œ`MODE_WORLD_READABLE` å’Œ `MODE_WORLD_WRITEABLE` æ¨¡å¼å·²è¢«å¼ƒç”¨ã€‚ ä» Android 7.0ï¼ˆAPI çº§åˆ« 24ï¼‰å¼€å§‹ï¼Œå¦‚æœæ‚¨ä½¿ç”¨è¿™äº›æ¨¡å¼ï¼ŒAndroid ä¼šæŠ›å‡º `SecurityException`ã€‚å¦‚æœæ‚¨çš„åº”ç”¨éœ€è¦ä¸å…¶ä»–åº”ç”¨å…±äº«ç§æœ‰æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ `FLAG_GRANT_READ_URI_PERMISSION` ä½¿ç”¨ `FileProvider`ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œå¦è¯·å‚é˜…[å…±äº«æ–‡ä»¶](https://developer.android.google.cn/training/secure-file-sharing?hl=zh-cn)ã€‚

é™¤äº†å¯ä»¥å‚¨å­˜å­—ç¬¦ä¸²å’Œå¸ƒå°”ç±»å‹çš„æ•°æ®ï¼Œå‚¨å­˜booleanï¼Œstringï¼Œfloatï¼Œintï¼Œlongï¼Œsetå…­ç§æ•°æ®ç±»å‹ã€‚

å®ƒä¹Ÿæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå‰è€…æ˜¯â€é”®â€œï¼Œæˆ–è€…æ˜¯â€œå€¼â€

![](/images/04ac0e0fdf7a5d6818ce4da05848ee7a.png)

![](/images/d376ad1c3fa8acf94fa6f39348203d70.png)

**LoginActivityå®Œæ•´ä»£ç **

```java

public class LoginActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_login);

        EditText userNameEdit=findViewById(R.id.editTextTextPersonName);
        EditText userPwdEdit=findViewById(R.id.editTextTextPassword);

        Button loginBtn=findViewById(R.id.button);

        loginBtn.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                String userName=userNameEdit.getText().toString();
                String userPwd=userPwdEdit.getText().toString();
                if(userName.equals("starry")&&userPwd.equals("lx0411")){
                    //todo è·³è½¬åˆ°ä¸»é¡µé¢+ä¿å­˜ç”¨æˆ·å+ç™»å½•çŠ¶æ€

                    //SharedPreferencesæ˜¯æ¥å£ï¼Œå¹¶ä¸æ˜¯ç±»
                    /*
                    å‚æ•°ä¸€ï¼šå­˜å‚¨æ•°æ®çš„æ–‡ä»¶å
                     */
                    //è·å–SharedPreferenceså¯¹è±¡

                    SharedPreferences sp=getSharedPreferences("user",MODE_PRIVATE);
                    //è·å–Editorå¯¹è±¡çš„å¼•ç”¨
                    SharedPreferences.Editor editor=sp.edit();
                    //å°†è·å–è¿‡æ¥çš„å€¼æ”¾å…¥æ–‡ä»¶
                    editor.putString("username",userName);
                    editor.putBoolean("isLogin",true);
                    
                    //æœ€åè¦æäº¤æ•°æ®åˆ°æœ¬åœ°
                    editor.commit();

                    //ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°ç”¨æˆ·é¦–é¡µç•Œé¢
                    Intent intent=new Intent(LoginActivity.this,MainActivity.class);
                    startActivity(intent);
                    Toast.makeText(LoginActivity.this,"ç™»å½•æˆåŠŸ",Toast.LENGTH_LONG).show();

                }else{
                    Toast.makeText(LoginActivity.this,"ç™»å½•å¤±è´¥",Toast.LENGTH_LONG).show();
                }
            }
        });

    }
}
```

### ğŸ˜€ç”¨æˆ·é¦–é¡µç•Œé¢æ·»åŠ æ–‡æœ¬ç»„ä»¶

ç„¶åç®€å•çš„ä¸ºç”¨æˆ·é¦–é¡µç•Œé¢æ·»åŠ ä¸€ä¸ªæ–‡æœ¬ç»„ä»¶ç”¨æ¥æ¥å—ç­‰ä¼šå‚¨å­˜åœ¨`SharedPreferences`ä¸­çš„ç”¨æˆ·å

![](/images/562ca03b24b4783667ca3eb089f57fcf.png)

**activity_main.xmlä¸­çš„å®Œæ•´ä»£ç **

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity">

    <TextView
        android:id="@+id/textview"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Hello World!"
        android:textColor="@color/black"
        android:textSize="40sp"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintLeft_toLeftOf="parent"
        app:layout_constraintRight_toRightOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>
```

### ğŸ˜Šåœ¨`MainActivity`ä¸­è·å–åˆ°useræ–‡ä»¶

![](/images/7ade45b270a86fbf1e7f6782231fd666.png)

**MainActivityå®Œæ•´ä»£ç **

```java

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        TextView textView = findViewById(R.id.textView);
        //é€šè¿‡æ–‡ä»¶åè·å–åˆ°useræ–‡ä»¶
        SharedPreferences sp=getSharedPreferences("user",MODE_PRIVATE);
        //å–å‡ºé”®åä¸ºusernameçš„ç”¨æˆ·å  ç¬¬äºŒä¸ªå‚æ•°ä¸ºé”®å€¼ä¸ºç©ºæ—¶æŒ‡å®šçš„é»˜è®¤å€¼
        String userName=sp.getString("username","");
        //å°†ç”¨æˆ·åè®¾ç½®åˆ°æ–‡æœ¬ç»„ä»¶ä¸­
        textView.setText(userName);

    }
}
```

### ğŸ¤£ä¸ºç”¨æˆ·æ¬¢è¿ç•Œé¢è®¾ç½®èƒŒæ™¯

å›¾ç‰‡å¯ä»¥åœ¨åœ¨ç½‘ç»œä¸Šä¸‹è½½[qqæ¬¢è¿ç•Œé¢ - Bing images](https://cn.bing.com/images/search?view=detailV2&ccid=Fg%2b07Nyy&id=D5B4300266EF25713EA56CF96358B48F3BEAFEC3&thid=OIP.Fg-07NyyebJY25C1j9tM5AAAAA&mediaurl=https%3a%2f%2fimg-blog.csdn.net%2f20160207135333635&exph=690&expw=395&q=qq%E6%AC%A2%E8%BF%8E%E7%95%8C%E9%9D%A2&simid=608041385153737839&FORM=IRPRST&ck=B4268FAA9FBB765159B2D15913277D43&selectedIndex=1&ajaxhist=0&ajaxserp=0)

![](/images/db1154b4d043500a3b34b58f211b4b59.png)

**activity_welcome.xmlä¸­çš„å®Œæ•´ä»£ç **

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@drawable/welcome"
    tools:context=".WelcomeActivity">

</androidx.constraintlayout.widget.ConstraintLayout>
```

### ğŸ˜’åœ¨`WelcomeActivity`ä¸­å†™ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œè·å–åˆ°ç”¨æˆ·ç™»å½•çŠ¶æ€

![](/images/f165ce75e14bb1c4c5dc5bfa07cc576c.png)

**WelcomeActivityå®Œæ•´ä»£ç **

```java
public class WelcomeActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_welcome);

        Thread thread = new Thread() {
            public void run() {
                super.run();

                try {
                    Thread.sleep(2000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                //è¯»å–ç”¨æˆ·çš„ç™»å½•çŠ¶æ€
                SharedPreferences sp = getSharedPreferences("user", MODE_PRIVATE);
                Boolean isLogin = sp.getBoolean("isLogin", false);
                    //å¦‚æœç™»å½•çŠ¶æ€æ˜¯trueåˆ™ç›´æ¥è¿›å…¥ç”¨æˆ·é¦–é¡µ
                if (isLogin) {
                    Intent intent = new Intent(WelcomeActivity.this, MainActivity.class);
                    startActivity(intent);
                } else {
                    //å¦åˆ™è·³è½¬åˆ°ç”¨æˆ·ç™»å½•ç•Œé¢
                    Intent intent = new Intent(WelcomeActivity.this, LoginActivity.class);
                    startActivity(intent);
                }
            }
        };
        thread.start();
    }
}
```

### ğŸ˜˜è¿è¡Œæ•ˆæœ

é€šè¿‡åŠ¨å›¾å¯ä»¥å‘ç°ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•æ—¶æ˜¯éœ€è¦éªŒè¯èº«ä»½çš„ï¼Œè€Œç¬¬äºŒæ¬¡ç™»å½•ç”¨æˆ·å¯ä»¥ç›´æ¥è¿›å…¥â€qqé¦–é¡µç•Œé¢â€œï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç¬¬ä¸€æ¬¡ç™»å½•çš„æ—¶å€™å°†ç”¨æˆ·çš„ç™»å½•çŠ¶æ€è®°å½•åœ¨äº†useræ–‡ä»¶é‡Œï¼Œå†æ¬¡ç™»é™†æ—¶`WelcomeActivity`ä»£ç ä¸­è¯»å–åˆ°äº†ç”¨æˆ·çš„ç™»å½•çŠ¶æ€æ˜¯trueï¼Œæ‰€ä»¥ç›´æ¥è·³è½¬åˆ°ç”¨æˆ·é¦–é¡µç•Œé¢

![](/images/169e9d8a4e3a4435644bee30d08d1f52.gif)

é‚£ä¹ˆè¿™ä¸ªuseræ–‡ä»¶ä¿å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿ

å¯ä»¥çœ‹åˆ°åœ¨`data/data/é¡¹ç›®åŒ…å`çš„`shared_prefs`æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆäº†ä¸€ä¸ªuser.xmlçš„æ–‡ä»¶ï¼Œé‡Œé¢å­˜æ”¾å°±æ˜¯æˆ‘ä»¬çš„ç”¨æˆ·åå’Œç™»å½•çŠ¶æ€ä¿¡æ¯

![](/images/79935cb07ea6010693d18a23e323132d.png)

![](/images/9bd5f9cc2320f4cd947a0a0fdb37219f.gif)
